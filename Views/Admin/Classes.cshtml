@model IEnumerable<POETWeb.Controllers.AdminController.ClassRow>
@{
    ViewData["Title"] = "Manage Classes";
    var q = (string)(ViewBag.Query ?? "");
    int total = (int)(ViewBag.Total ?? 0);
}

<!-- Header -->
<nav class="adminbar shadow-sm">
    <div class="container-xxl d-flex align-items-center justify-content-between">
        <div class="py-2">
            <div class="small opacity-75">Administration</div>
            <h4 class="mb-0">Manage Classes</h4>
        </div>
        <div class="d-flex gap-2">
            <a asp-action="Index" class="btn btn-outline-light btn-sm">
                <i class="bi bi-arrow-left"></i> Back
            </a>
        </div>
    </div>
</nav>

<div class="container-xxl py-4">
    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
        <h5 class="m-0">Classes <span class="text-muted">(@total)</span></h5>
        <form method="get" class="d-flex gap-2">
            <input name="q" value="@q" class="form-control form-control-sm" style="min-width:260px" placeholder="Search class/teacher/code..." />
            <button type="submit" class="btn btn-primary btn-sm">Search</button>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead class="table-light">
                <tr>
                    <th>Class</th>
                    <th>Code</th>
                    <th>Teacher</th>
                    <th>Students</th>
                    <th>Created</th>
                    <th style="width:1%"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var c in Model)
                {
                    <tr>
                        <td>
                            <strong>@c.Name</strong><br />
                            <small class="text-muted">@c.Subject</small>
                        </td>
                        <td><code>@c.ClassCode</code></td>
                        <td>@c.TeacherName</td>
                        <td>@c.Students</td>
                        <td>@c.CreatedAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                        <td class="text-end">
                            <a class="btn btn-outline-secondary btn-sm" asp-action="Materials" asp-route-classId="@c.Id">Materials</a>
                            <a class="btn btn-outline-secondary btn-sm" asp-action="Assignments" asp-route-classId="@c.Id">Assignments</a>
                            <a class="btn btn-outline-secondary btn-sm" asp-action="Students" asp-route-classId="@c.Id">Students</a>
                            <form asp-action="DeleteClass" method="post" class="d-inline" onsubmit="return confirm('Delete this class (cascade)?');">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@c.Id" />
                                <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Styles {
    <style>
        .adminbar {
            background: linear-gradient(90deg,#0ea5e9,#6366f1);
            color: #fff
        }

            .adminbar .btn {
                border-color: rgba(255,255,255,.7);
                color: #fff
            }

                .adminbar .btn:hover {
                    background: rgba(255,255,255,.12);
                    color: #fff
                }
    </style>
}
